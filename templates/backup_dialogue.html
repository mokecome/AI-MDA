
<html>
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="icon" href="static/logo.png">
    <link
    href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css"
    rel="stylesheet"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;700&display=swap"
      rel="stylesheet"
    />
    <script src="https://cdn.jsdelivr.net/npm/vue@3.3.11/dist/vue.global.prod.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
      body {
        font-family: "Noto Sans TC", sans-serif;
        padding-bottom: 120px; /* 增加底部間距，避免輸入框被遮擋 */
      }

      .fixed-input-container {
        position: fixed;
        bottom: 50px; /* 調整位置，使其位於footer上方 */
        left: 0;
        width: 100%;
        padding: 20px;
        display: flex;
        align-items: center;
        z-index: 1000; /* 確保輸入框在最上層 */
      }
      .footer {
        position: fixed;
        bottom: 0;
        left: 0;
        width: 100%;
        background-color: white;
        /* z-index: 999;  */
      }
      .fixed-sidebar {
        position: absolute;
        top: 120px; 
        right: 20px;
        width: 20%; 
      }
      .message-container {
        display: flex;
        align-items: flex-start;
        margin-bottom: 1rem;
      }

      .message-container.user {
        justify-content: flex-end;
      }

      .message-bubble {
        max-width: 60%;
        padding: 0.75rem;
        border-radius: 1rem;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
      }

      .message-bubble.user {
        background-color: #e0f7fa;
        text-align: right;
        margin-left: auto; /* 用戶的對話框在右側 */
      }

      .message-bubble.bot {
        background-color: #f1f1f1;
        text-align: left;
        margin-right: auto; /* 機器人的對話框在左側 */
      }

      .message-avatar {
        width: 3rem;
        height: 3rem;
        margin-right: 1rem;
        border-radius: 50%;
      }

      .message-container.user .message-avatar {
        margin-left: 1rem;
        margin-right: 0;
      }
      .message-container.bot {
        justify-content: flex-start;
      }
      .shadow-md {
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1); /* 柔和陰影 */
      }
      .border {
        border-width: 1px;
        border-color: #d1d5db; /* 淡灰色邊框 */
      }
      .transition {
        transition: background-color 0.3s ease; /* 平滑過渡 */
      }
      .duration-300 {
        transition-duration: 300ms;
      }


    </style>
  </head>

  <body>
    <!-- <div id="app"> -->
    <div class="min-h-screen flex flex-col" id="app">
      <header class="flex items-center justify-between p-4 bg-gray-100 w-full top-0 z-10 h-12 shadow-md">
        <div class="flex items-center pl-2">
          <img src="static/logo.png" alt="AI-MDA Logo" class="h-9 w-auto">
        </div>
        <nav class="flex items-center space-x-4 pr-2">
          <button class="text-gray-700" @click="navigateHome">Home</button>
          <a class="text-gray-700" href="#"> About </a>
          <div class="relative">
          </div>
        </nav>
      </header>
      <main class="flex-grow container mx-auto px-4 py-8">
      <div class="flex-grow container mx-auto px-4 py-8">
        <div v-if="showWelcome" class="text-center mb-8">
          <h1 class="text-4xl font-bold mb-2">Welcome to AI-MDA !</h1>
          <p class="text-gray-600">
            歡迎來到AI醫療數據自動化生成器，我們將藉由AI幫助您快速整理醫療數據。
          </p>
        </div>
            <div v-if="!showWelcome">  
            <div
              v-for="message in messages"
              :key="message.id"
              :class="['message-container', message.sender]"
            >
              <img
                v-if="message.sender === 'bot'"
                src="static/bot-image.png"
                alt="Bot"
                class="message-avatar"
              />
              <div :class="['message-bubble', message.sender]">
                {{ message.text }}
              </div>
              <img
                v-if="message.sender === 'user'"
                src="static/user-image.png"
                alt="User"
                class="message-avatar"
              />
            </div>
          </div>
          <aside class="fixed-sidebar bg-gray-200 p-4 rounded-lg shadow-md">
          <!-- <aside class="w-1/4 bg-gray-200 p-4 rounded-lg shadow-md ml-4"> -->
            <h2 class="text-lg font-bold mb-4">常用標籤</h2>
            <div class="space-y-2">
              <button
                @click="handleButtonClick('男女比例')"
                class="bg-white px-4 py-2 rounded-full shadow-md"
              >
                男女比例
              </button>
              <button
                @click="handleButtonClick('男女比例')"
                class="bg-white px-4 py-2 rounded-full shadow-md"
              >
                男女比例
              </button>
              <button
                @click="handleButtonClick('B型肝炎人數')"
                class="bg-white px-4 py-2 rounded-full shadow-md"
              >
                B型肝炎人數
              </button>
              <button
                @click="handleButtonClick('B型肝炎人數')"
                class="bg-white px-4 py-2 rounded-full shadow-md"
              >
                B型肝炎人數
              </button>
              <button
                @click="handleButtonClick('來客率')"
                class="bg-white px-4 py-2 rounded-full shadow-md"
              >
                來客率
              </button>
              <button
                @click="handleButtonClick('來客率')"
                class="bg-white px-4 py-2 rounded-full shadow-md"
              >
                來客率
              </button>
              <button
                @click="handleButtonClick('來客率')"
                class="bg-white px-4 py-2 rounded-full shadow-md"
              >
                來客率
              </button>
              <button
                @click="handleButtonClick('來客率')"
                class="bg-white px-4 py-2 rounded-full shadow-md"
              >
                來客率
              </button>
            </div>
          </aside>
        </main>
        </div>
          <div class="fixed-input-container" v-if="!showWelcome">
            <input
            v-model="userInput"
            class="w-3/4 bg-white p-3 rounded-full shadow-md border border-gray-300"
            placeholder="請輸入您想要詢問的內容"
            type="text"
          />
          <!-- class="flex-grow bg-white p-3 rounded-full shadow-md border border-gray-300" -->
          <button
           @click="sendMessage"
            class="ml-4 bg-blue-500 text-white p-4 rounded-full shadow-md hover:bg-blue-600 transition duration-300"
          >
            <i class="fas fa-arrow-up"></i>
          </button>
        </div>
        
      <footer class="footer py-4 shadow-md">
        <div class="container mx-auto px-4 flex justify-between items-center">
          <span class="text-gray-600">中文(繁體)</span>
          <span class="text-gray-600">© 2024 Meeting Assistant, All Rights Reserved.</span>
        </div>
      </footer>
    </div>
    <script>
    document.addEventListener('DOMContentLoaded', function() {
      const { createApp, ref } = Vue;

      const app = createApp({
        setup() {
          console.log('Vue app is being set up'); // Debug line

          const showWelcome = ref(true);
          const userInput = ref("");
          const messages = ref([]);

          const sendMessage = async () => {
          if (userInput.value.trim() === "") return;
          const message = userInput.value;

            // Hide welcome content
            showWelcome.value = false;

            console.log('User message:', message); // Debug line

            // Add user's message to messages
            messages.value.push({
              id: Date.now(),
              text: message,
              sender: "user",
            });

            try {
              // Send data to backend API and handle response
              const response = await axios.post(
                "http://127.0.0.1:5000/api/send_message",
                { userMessage: message },
                { headers: { "Content-Type": "application/json" } }
              );
              
              console.log('Bot response:', response.data.response); // Debug line

              messages.value.push({
                id: Date.now() + 1,
                text: response.data.response,
                sender: "bot",
              });

              console.log(messages.value);

              } catch (error) {
                console.error("Error sending message to backend:", error);
                messages.value.push({
                  id: Date.now() + 1,
                  text: "Error: Unable to get a response from the backend.",
                  sender: "bot",
                });
              }

            userInput.value = "";
            console.log('Messages:', messages.value); // Debug line
          };


          const handleButtonClick = (presetMessage) => {
            userInput.value = presetMessage;
            sendMessage();
          };

          return {
            showWelcome,
            userInput,
            messages,
            sendMessage,
            handleButtonClick,
          };
        },
        methods: {
          navigateHome() {
            window.location.href = "/templates/index.html"
        },
      },
    });

    // 設置 Vue 的全局錯誤處理器
    // app.config.globalProperties.config.errorHandler = (err, vm, info) => {
    //   console.error(`Error: ${err.toString()}\nInfo: ${info}`);
    // };
        
      app.mount("#app");
    });
  </script>
  </body>
</html>
